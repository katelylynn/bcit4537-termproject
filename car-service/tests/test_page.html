<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Two-Wheel Drive Remote Control</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 50px;
        }

        .vertical-slider {
            -webkit-appearance: slider-vertical;
            writing-mode: bt-lr; /* Vertical slider */
            width: 30px;
            height: 2in; /* Set height to 2 inches */
        }

        .horizontal-slider {
            width: 2in; /* Set width to 2 inches */
        }

        button {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Two-Wheel Drive Remote Control</h1>

    <div class="slider-container">
        <div>
            <label for="vertical-slider">Forward/Backward</label><br>
            <input type="range" id="vertical-slider" class="vertical-slider" min="-1" max="1" step="0.01" value="0">
        </div>

        <div>
            <label for="horizontal-slider">Angle</label><br>
            <input type="range" id="horizontal-slider" class="horizontal-slider" min="-1" max="1" step="0.01" value="0">
        </div>
    </div>

    <button onclick="stopMotors()">Stop</button>

    <script>
        const baseURL = "http://localhost:5000";

        const verticalSlider = document.getElementById("vertical-slider");
        const horizontalSlider = document.getElementById("horizontal-slider");

        let lastVerticalValue = verticalSlider.value;
        let lastHorizontalValue = horizontalSlider.value;

        let isThrottled = false;
        const throttleInterval = 500; // milliseconds (n = 2 requests per second)

        function sendUpdates() {
            const speed = Math.abs(parseFloat(verticalSlider.value));
            const direction = parseFloat(verticalSlider.value) >= 0 ? 'forward' : 'backward';
            const harshness = parseFloat(horizontalSlider.value);

            // Only send updates if the slider values have changed
            if (verticalSlider.value !== lastVerticalValue || horizontalSlider.value !== lastHorizontalValue) {
                lastVerticalValue = verticalSlider.value;
                lastHorizontalValue = horizontalSlider.value;

                // Throttle the requests to at most n per second
                if (!isThrottled) {
                    isThrottled = true;

                    fetch(`${baseURL}/${direction}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            speed: speed,
                            harshness: harshness
                        })
                    })
                    .then(response => response.json())
                    .then(data => console.log("Response:", data))
                    .catch(error => console.error("Error:", error));

                    setTimeout(() => {
                        isThrottled = false;
                    }, throttleInterval);
                }
            }
        }

        // Event listeners for slider input changes
        verticalSlider.addEventListener("input", sendUpdates);
        horizontalSlider.addEventListener("input", sendUpdates);

        // Function to stop the motors
        function stopMotors() {
            fetch(`${baseURL}/stop`, {
                method: "POST"
            })
            .then(response => response.json())
            .then(data => console.log("Motors stopped:", data))
            .catch(error => console.error("Error:", error));

            // Reset slider values to zero
            verticalSlider.value = 0;
            horizontalSlider.value = 0;
            lastVerticalValue = "0";
            lastHorizontalValue = "0";
        }
    </script>
</body>
</html>
